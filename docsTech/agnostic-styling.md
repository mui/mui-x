# Agnostic styling

### Summary

The core codebase is written using the `slot()` syntax. This syntax is compiled down to `styled()` calls for the material datagrid, and CSS stylesheets for the core datagrid.

### Conditional styles

We currently use to a small extent the `({ ownerState }) => /* dynamic styles */` pattern to apply conditional styles. This pattern is not applicable to CSS stylesheets with the proposed solution because we rely on having static styles. Supporting that pattern would amount to re-implementing PigmentCSS here.

#### Current situation

```javascript.jsx
const useUtilityClasses = (ownerState) => { /* ... */ }

const GridQuickFilterTrigger = styled(ToolbarButton, {
  name: 'MuiDataGrid',
  slot: 'toolbarQuickFilterTrigger',
})(({ ownerState }: { ownerState: OwnerState }) => ({
  zIndex: 1,
  opacity: ownerState.expanded ? 0 : 1,
  pointerEvents: ownerState.expanded ? 'none' : 'auto',
  transition: vars.transition(['opacity']),
}));

// usage
const classes = useUtilityClasses(rootProps)
<GridQuickFilterTrigger
  ownerState={{ ...rootProps, expanded: true }}
  className={classes.trigger}
/>
```

#### Proposed syntax

```javascript.jsx
const triggerSlot = slot({
  name: 'MuiDataGrid',
  slot: 'toolbarQuickFilterTrigger',
  as: ToolbarButton,
}, {
  root: {
    zIndex: 1,
    opacity: 1,
    pointerEvents: 'auto',
    transition: vars.transition(['opacity']),
  },
  expanded: {
    opacity: 0,
    pointerEvents: 'none',
  },
}));

// usage
const trigger = useGridStyleSlot(rootProps, triggerSlot)
<trigger.component
  ownerState={rootProps}
  className={clsx(
    trigger.classes.root,
    expanded && trigger.classes.expanded,
  )}
/>
```

#### Proposed compilation (emotion)

```javascript.jsx
const triggerSlot = {
  component: styled(ToolbarButton, {
    name: 'MuiDataGrid',
    slot: 'toolbarQuickFilterTrigger',
  })({
    /* root: */
    zIndex: 1,
    opacity: 1,
    pointerEvents: 'auto',
    transition: vars.transition(['opacity']),

    /* expanded: */
    '&.MuiDataGrid-toolbarQuickFilterTrigger--expanded': {
      opacity: 0,
      pointerEvents: 'none',
    },
  }),
  classes: {
    root: 'MuiDataGrid-toolbarQuickFilterTrigger',
    expanded: 'MuiDataGrid-toolbarQuickFilterTrigger--expanded',
  },
}

// usage
const trigger = useGridStyleSlot(rootProps, triggerSlot)
<trigger.component
  ownerState={rootProps}
  className={clsx(
    trigger.classes.root,
    expanded && trigger.classes.expanded,
  )}
/>
```

#### Proposed compilation (no emotion)

```javascript.jsx
import './[currentFilename].autogenerated.css';

const triggerSlot = slot({
  name: 'MuiDataGrid',
  slot: 'toolbarQuickFilterTrigger',
  as: ToolbarButton,
}, {
  root: 'MuiDataGrid-toolbarQuickFilterTrigger',
  expanded: 'MuiDataGrid-toolbarQuickFilterTrigger--expanded',
}))

// usage
const trigger = useGridStyleSlot(rootProps, triggerSlot)
<trigger.component
  ownerState={rootProps}
  className={clsx(
    trigger.classes.root,
    expanded && trigger.classes.expanded,
  )}
/>
```

#### Downsides

- Right now, the development mode uses the packages source code directly to run. If we require a build step to turn the core grid codebase into emotion/non-emotion builds, the DX for working on the material grid might become worst. Keep in mind that in this scenario, most of the datagrid codebase would be inside the core grid package(s), while only leaf material code would live inside the `@mui/x-data-grid{,pro,premium}` packages.

- Breaking change: users can't rely on non-standard `ownerState` values (like `.expanded` above) to add overrides, we'd likely standardize `ownerState` to just `rootProps`.

- In the `styled()` build, conditional classnames would be compiled to something like `&.ROOT--MODIFIER` (in other words, `.css-12345.ROOT--MODIFIER`) so they would have a specificity of `0-2-0`. Therefore, using `sx={{ color: 'red' }}` would not be enough to override those styles because `sx` styles would be placed inside the `.css-12345` class (with specificity `0-1-0`). Users would need to override with `sx={{ '&&': { color: 'red' } }}` or `sx={{ '&.ROOT--MODIFIER': { color: 'red' } }}`.
